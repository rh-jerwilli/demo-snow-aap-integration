- name: Watch for new records
  hosts: all
  sources:
  
    - name: Watch for records using sys_created_on
      servicenow.itsm.records:
        instance:
          host: "{{ SN_HOST }}"
          username: "{{ SN_USERNAME }}"
          password: "{{ SN_PASSWORD }}"
        table: incident
        remote_servicenow_timezone: EST
        timestamp_field: sys_created_on
        interval: 10

  rules:
    - name: New record created
      condition: event.sys_id is defined
      action:
        run_job_template:
        name: "hello_from_snow"
        organization: "Default"
        extra_vars:
          snow_incident_sys_id: "{{ event.sys_id }}"
          snow_incident_number: "{{ event.number }}"
          snow_incident_short_description: "{{ event.short_description }}"
          message_content: "{{ event.payload.message }}"

    - name: Dump event for debug
      condition: true
      action:
        debug:
          msg: "{{ event }}"
